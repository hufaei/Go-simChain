# simchain-go

<div align="center">

![Go Version](https://img.shields.io/badge/Go-1.21+-00ADD8?style=flat&logo=go)
![License](https://img.shields.io/badge/License-MIT-green?style=flat)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey?style=flat)

**ä¸€ä¸ªæç®€çš„ PoW åŒºå—é“¾æ¨¡æ‹Ÿå™¨**

[å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢
[æ¶æ„è®¾è®¡](#-æ¶æ„è®¾è®¡) â€¢
[TCP æ¨¡å¼](#-tcp-å¤šè¿›ç¨‹æ¨¡å¼) â€¢
[æµ‹è¯•éªŒè¯](#-æµ‹è¯•)

</div>

---

## ğŸ“– ç®€ä»‹

simchain-go æ˜¯ä¸€ä¸ªæœ¬åœ°æç®€ PoW åŒºå—é“¾æ¨¡æ‹Ÿå™¨ï¼Œç”¨äºå­¦ä¹ å’Œæµ‹è¯•åŒºå—é“¾æ ¸å¿ƒæ¦‚å¿µï¼š

- â›ï¸ **PoW æŒ–çŸ¿** - å¯é…ç½®éš¾åº¦çš„å·¥ä½œé‡è¯æ˜
- ğŸ”— **é“¾åŒæ­¥** - Headers-first åŒæ­¥åè®®
- ğŸŒ **P2P ç½‘ç»œ** - æ”¯æŒ TCP å¤šè¿›ç¨‹æˆ– inproc å•è¿›ç¨‹æ¨¡å¼
- ğŸ’¾ **æŒä¹…åŒ–** - ä¸»é“¾æ•°æ®è½ç›˜ä¸é‡å¯æ¢å¤
- ğŸ”’ **èº«ä»½ç»‘å®š** - Ed25519 æ¡æ‰‹éªŒè¯

> âš ï¸ **å£°æ˜**: æœ¬é¡¹ç›®éƒ¨åˆ†ä»£ç åŸºäº AI è¾…åŠ©ç”Ÿæˆï¼Œä»…ä¾›å­¦ä¹ æµ‹è¯•ä½¿ç”¨ï¼Œä¸é€‚ç”¨äºç”Ÿäº§ç¯å¢ƒã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ„å»º

```bash
# æ„å»ºèŠ‚ç‚¹
go build -o simchain-node ./cmd/node

# æ„å»ºå®¢æˆ·ç«¯
go build -o simchain-cli ./cmd/cli
```

### Inproc æ¨¡å¼ï¼ˆå•è¿›ç¨‹å¤šèŠ‚ç‚¹ï¼‰

```bash
# å¯åŠ¨ 2 èŠ‚ç‚¹ä»¿çœŸï¼Œè¿è¡Œ 30 ç§’
./simchain-node --nodes=2 --difficulty=16 --duration=30s
```

### TCP æ¨¡å¼ï¼ˆå¤šè¿›ç¨‹ï¼‰

```bash
# ç»ˆç«¯ 1: Seed èŠ‚ç‚¹
./simchain-node --transport=tcp --listen=127.0.0.1:50001 --duration=0

# ç»ˆç«¯ 2: æ™®é€šèŠ‚ç‚¹
./simchain-node --transport=tcp --listen=127.0.0.1:50002 --seeds=127.0.0.1:50001 --duration=0

# ç»ˆç«¯ 3: æ™®é€šèŠ‚ç‚¹
./simchain-node --transport=tcp --listen=127.0.0.1:50003 --seeds=127.0.0.1:50001 --duration=0
```

---

## ğŸ—ï¸ æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Node (ç¼–æ’è€…)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Miner  â”‚ â”‚ Mempool â”‚ â”‚ Chain â”‚ â”‚    Syncer     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              Transport (inproc/TCP)            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Store                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è¯¦ç»†è®¾è®¡æ–‡æ¡£ï¼š
- [`DESIGN.md`](./DESIGN.md) - V1 åŸºç¡€è®¾è®¡
- [`DESIGN_V2.md`](./DESIGN_V2.md) - V2 Inv/Get åè®®
- [`DESIGN_V3_UNIFIED.md`](./DESIGN_V3_UNIFIED.md) - V3 TCP + æŒä¹…åŒ– + å¥å£®æ€§

---

## ğŸŒ TCP å¤šè¿›ç¨‹æ¨¡å¼

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--transport` | ä¼ è¾“æ–¹å¼ `inproc\|tcp` | `inproc` |
| `--listen` | TCP ç›‘å¬åœ°å€ | - |
| `--seeds` | Seed èŠ‚ç‚¹åˆ—è¡¨ï¼ˆé€—å·åˆ†éš”ï¼‰ | - |
| `--data-dir` | æ•°æ®ç›®å½• | `data/tcp-<port>` |
| `--difficulty` | PoW éš¾åº¦ï¼ˆå‰å¯¼é›¶ bitsï¼‰ | `16` |
| `--duration` | è¿è¡Œæ—¶é•¿ï¼ˆ`0` = æ°¸ä¹…ï¼‰ | `30s` |
| `--tx-interval` | äº¤æ˜“æ³¨å…¥é—´éš” | `1s` |
| `--max-tx-per-block` | æ¯å—æœ€å¤§äº¤æ˜“æ•° | `50` |
| `--miner-sleep` | æŒ–çŸ¿é—´éš” | `10ms` |

### æ¼”ç¤ºè„šæœ¬

<details>
<summary>Windows (PowerShell)</summary>

```powershell
.\scripts\run-tcp-demo.ps1 -BasePort 50001 -Nodes 3 -DurationSec 20 -Difficulty 16
```

</details>

<details>
<summary>Linux/macOS (Bash)</summary>

```bash
BASE_PORT=50001 NODES=3 DURATION_SEC=20 ./scripts/run-tcp-demo.sh
```

</details>

### CLI å®¢æˆ·ç«¯

```bash
# æäº¤äº¤æ˜“
./simchain-cli --connect=127.0.0.1:50001 --cmd=submit --data="hello world"
```

---

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
go test ./...
```

### é›†æˆæµ‹è¯•

```bash
go test ./internal/integration -run TestTCPE2E -v
```

### éªŒè¯è„šæœ¬

<details>
<summary>Mempool å®¹é‡æµ‹è¯• (testPool.ps1)</summary>

```powershell
# å‰ç½®: å¯åŠ¨èŠ‚ç‚¹
./simchain-node --transport=tcp --listen=127.0.0.1:50001 --duration=0

# è¿è¡Œæµ‹è¯• (å¦ä¸€ç»ˆç«¯)
./testPool.ps1
```

é¢„æœŸ: Mempool å¢é•¿è‡³ 5000 åç¨³å®šï¼Œæ‹’ç»åç»­äº¤æ˜“ã€‚

</details>

<details>
<summary>TCP è¿æ¥é™åˆ¶æµ‹è¯• (verify_v3c.py)</summary>

```bash
# è¿æ¥æ•°é™åˆ¶
python verify_v3c.py tcp-limit --port 50001 --count 10

# Slowloris é˜²æŠ¤
python verify_v3c.py slowloris --port 50001
```

</details>

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
simchain-go/
â”œâ”€â”€ cmd/
â”‚   â”œâ”€â”€ node/          # èŠ‚ç‚¹ä¸»ç¨‹åº
â”‚   â””â”€â”€ cli/           # å‘½ä»¤è¡Œå®¢æˆ·ç«¯
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ blockchain/    # é“¾ç´¢å¼•ä¸ reorg
â”‚   â”œâ”€â”€ mempool/       # äº¤æ˜“æ± 
â”‚   â”œâ”€â”€ syncer/        # åŒæ­¥çŠ¶æ€æœº
â”‚   â”œâ”€â”€ transport/     # ç½‘ç»œä¼ è¾“ (inproc/TCP)
â”‚   â”œâ”€â”€ store/         # æŒä¹…åŒ–
â”‚   â””â”€â”€ ...
â”œâ”€â”€ scripts/           # æ¼”ç¤ºè„šæœ¬
â”œâ”€â”€ data/              # è¿è¡Œæ—¶æ•°æ®
â””â”€â”€ *.md               # è®¾è®¡æ–‡æ¡£
```

å®Œæ•´ç»“æ„è§ [`FILE_TREE.md`](./FILE_TREE.md)

---

## ğŸ“œ åè®®

TCP æ¶ˆæ¯ç¼–ç ä¸ framing çº¦å®šè§ [`PROTOCOL.md`](./PROTOCOL.md)

---

## ğŸ“„ License

MIT
